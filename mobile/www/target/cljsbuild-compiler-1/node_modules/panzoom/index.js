goog.provide("module$Applications$server$dungeon_builder$node_modules$panzoom$index");
goog.provide("module$panzoom");
goog.provide("module$panzoom$index");
goog.require("module$Applications$server$dungeon_builder$node_modules$wheel$index");
goog.require("module$Applications$server$dungeon_builder$node_modules$amator$index");
goog.require("module$Applications$server$dungeon_builder$node_modules$ngraph_events$index");
goog.require("module$Applications$server$dungeon_builder$node_modules$panzoom$lib$kinetic");
goog.require("module$Applications$server$dungeon_builder$node_modules$panzoom$lib$textSelectionInterceptor");
goog.require("module$Applications$server$dungeon_builder$node_modules$panzoom$lib$transform");
goog.require("module$Applications$server$dungeon_builder$node_modules$panzoom$lib$svgController");
goog.require("module$Applications$server$dungeon_builder$node_modules$panzoom$lib$domController");
var module$Applications$server$dungeon_builder$node_modules$panzoom$index={};
module$Applications$server$dungeon_builder$node_modules$panzoom$index["default"]=function(domElement,options){options=options||{};var panController=options.controller;if(!panController){if(domElement instanceof SVGElement)panController=(0,module$Applications$server$dungeon_builder$node_modules$panzoom$lib$svgController["default"])(domElement,options);if(domElement instanceof HTMLElement)panController=(0,module$Applications$server$dungeon_builder$node_modules$panzoom$lib$domController["default"])(domElement,options)}if(!panController)throw new Error("Cannot create panzoom for the current type of dom element");
var owner=panController.getOwner();var storedCTMResult={x:0,y:0};var isDirty=false;var transform=new module$Applications$server$dungeon_builder$node_modules$panzoom$lib$transform["default"];if(panController.initTransform)panController.initTransform(transform);var filterKey=typeof options.filterKey==="function"?options.filterKey:noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index;var pinchSpeed=typeof options.pinchSpeed==="number"?options.pinchSpeed:1;var bounds=options.bounds;
var maxZoom=typeof options.maxZoom==="number"?options.maxZoom:Number.POSITIVE_INFINITY;var minZoom=typeof options.minZoom==="number"?options.minZoom:0;var boundsPadding=typeof options.boundsPadding==="number"?options.boundsPadding:.05;var zoomDoubleClickSpeed=typeof options.zoomDoubleClickSpeed==="number"?options.zoomDoubleClickSpeed:defaultDoubleTapZoomSpeed$$module$Applications$server$dungeon_builder$node_modules$panzoom$index;var beforeWheel=options.beforeWheel||noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index;
var speed=typeof options.zoomSpeed==="number"?options.zoomSpeed:defaultZoomSpeed$$module$Applications$server$dungeon_builder$node_modules$panzoom$index;validateBounds$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds);if(options.autocenter)autocenter();var frameAnimation;var lastTouchEndTime=0;var touchInProgress=false;var panstartFired=false;var mouseX;var mouseY;var pinchZoomLength;var smoothScroll;if("smoothScroll"in options&&!options.smoothScroll)smoothScroll=rigidScroll$$module$Applications$server$dungeon_builder$node_modules$panzoom$index();
else smoothScroll=(0,module$Applications$server$dungeon_builder$node_modules$panzoom$lib$kinetic["default"])(getPoint,scroll,options.smoothScroll);var moveByAnimation;var zoomToAnimation;var multiTouch;var paused=false;listenForEvents();var api={dispose:dispose,moveBy:internalMoveBy,moveTo:moveTo,centerOn:centerOn,zoomTo:publicZoomTo,zoomAbs:zoomAbs,smoothZoom:smoothZoom,smoothZoomAbs:smoothZoomAbs,showRectangle:showRectangle,pause:pause,resume:resume,isPaused:isPaused,getTransform:getTransformModel,
getMinZoom:getMinZoom,getMaxZoom:getMaxZoom};(0,module$Applications$server$dungeon_builder$node_modules$ngraph_events$index["default"])(api);return api;function pause(){releaseEvents();paused=true}function resume(){if(paused){listenForEvents();paused=false}}function isPaused(){return paused}function showRectangle(rect){var clientRect=owner.getBoundingClientRect();var size=transformToScreen(clientRect.width,clientRect.height);var rectWidth=rect.right-rect.left;var rectHeight=rect.bottom-rect.top;if(!Number.isFinite(rectWidth)||
!Number.isFinite(rectHeight))throw new Error("Invalid rectangle");var dw=size.x/rectWidth;var dh=size.y/rectHeight;var scale=Math.min(dw,dh);transform.x=-(rect.left+rectWidth/2)*scale+size.x/2;transform.y=-(rect.top+rectHeight/2)*scale+size.y/2;transform.scale=scale}function transformToScreen(x,y){if(panController.getScreenCTM){var parentCTM=panController.getScreenCTM();var parentScaleX=parentCTM.a;var parentScaleY=parentCTM.d;var parentOffsetX=parentCTM.e;var parentOffsetY=parentCTM.f;storedCTMResult.x=
x*parentScaleX-parentOffsetX;storedCTMResult.y=y*parentScaleY-parentOffsetY}else{storedCTMResult.x=x;storedCTMResult.y=y}return storedCTMResult}function autocenter(){var w;var h;var left=0;var top=0;var sceneBoundingBox=getBoundingBox();if(sceneBoundingBox){left=sceneBoundingBox.left;top=sceneBoundingBox.top;w=sceneBoundingBox.right-sceneBoundingBox.left;h=sceneBoundingBox.bottom-sceneBoundingBox.top}else{var ownerRect=owner.getBoundingClientRect();w=ownerRect.width;h=ownerRect.height}var bbox=panController.getBBox();
if(bbox.width===0||bbox.height===0)return;var dh=h/bbox.height;var dw=w/bbox.width;var scale=Math.min(dw,dh);transform.x=-(bbox.left+bbox.width/2)*scale+w/2+left;transform.y=-(bbox.top+bbox.height/2)*scale+h/2+top;transform.scale=scale}function getTransformModel(){return transform}function getMinZoom(){return minZoom}function getMaxZoom(){return maxZoom}function getPoint(){return{x:transform.x,y:transform.y}}function moveTo(x,y){transform.x=x;transform.y=y;keepTransformInsideBounds();triggerEvent("pan");
makeDirty()}function moveBy(dx,dy){moveTo(transform.x+dx,transform.y+dy)}function keepTransformInsideBounds(){var boundingBox=getBoundingBox();if(!boundingBox)return;var adjusted=false;var clientRect=getClientRect();var diff=boundingBox.left-clientRect.right;if(diff>0){transform.x+=diff;adjusted=true}diff=boundingBox.right-clientRect.left;if(diff<0){transform.x+=diff;adjusted=true}diff=boundingBox.top-clientRect.bottom;if(diff>0){transform.y+=diff;adjusted=true}diff=boundingBox.bottom-clientRect.top;
if(diff<0){transform.y+=diff;adjusted=true}return adjusted}function getBoundingBox(){if(!bounds)return;if(typeof bounds==="boolean"){var ownerRect=owner.getBoundingClientRect();var sceneWidth=ownerRect.width;var sceneHeight=ownerRect.height;return{left:sceneWidth*boundsPadding,top:sceneHeight*boundsPadding,right:sceneWidth*(1-boundsPadding),bottom:sceneHeight*(1-boundsPadding)}}return bounds}function getClientRect(){var bbox=panController.getBBox();var leftTop=client(bbox.left,bbox.top);return{left:leftTop.x,
top:leftTop.y,right:bbox.width*transform.scale+leftTop.x,bottom:bbox.height*transform.scale+leftTop.y}}function client(x,y){return{x:x*transform.scale+transform.x,y:y*transform.scale+transform.y}}function makeDirty(){isDirty=true;frameAnimation=window.requestAnimationFrame(frame)}function zoomByRatio(clientX,clientY,ratio){if(isNaN$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(clientX)||isNaN$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(clientY)||
isNaN$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(ratio))throw new Error("zoom requires valid numbers");var newScale=transform.scale*ratio;if(newScale<minZoom){if(transform.scale===minZoom)return;ratio=minZoom/transform.scale}if(newScale>maxZoom){if(transform.scale===maxZoom)return;ratio=maxZoom/transform.scale}var size=transformToScreen(clientX,clientY);transform.x=size.x-ratio*(size.x-transform.x);transform.y=size.y-ratio*(size.y-transform.y);if(bounds&&boundsPadding===
1&&minZoom===1){transform.scale*=ratio;keepTransformInsideBounds()}else{var transformAdjusted=keepTransformInsideBounds();if(!transformAdjusted)transform.scale*=ratio}triggerEvent("zoom");makeDirty()}function zoomAbs(clientX,clientY,zoomLevel){var ratio=zoomLevel/transform.scale;zoomByRatio(clientX,clientY,ratio)}function centerOn(ui){var parent=ui.ownerSVGElement;if(!parent)throw new Error("ui element is required to be within the scene");var clientRect=ui.getBoundingClientRect();var cx=clientRect.left+
clientRect.width/2;var cy=clientRect.top+clientRect.height/2;var container=parent.getBoundingClientRect();var dx=container.width/2-cx;var dy=container.height/2-cy;internalMoveBy(dx,dy,true)}function internalMoveBy(dx,dy,smooth){if(!smooth)return moveBy(dx,dy);if(moveByAnimation)moveByAnimation.cancel();var from={x:0,y:0};var to={x:dx,y:dy};var lastX=0;var lastY=0;moveByAnimation=(0,module$Applications$server$dungeon_builder$node_modules$amator$index["default"])(from,to,{step:function(v){moveBy(v.x-
lastX,v.y-lastY);lastX=v.x;lastY=v.y}})}function scroll(x,y){cancelZoomAnimation();moveTo(x,y)}function dispose(){releaseEvents()}function listenForEvents(){owner.addEventListener("mousedown",onMouseDown);owner.addEventListener("dblclick",onDoubleClick);owner.addEventListener("touchstart",onTouch);owner.addEventListener("keydown",onKeyDown);module$Applications$server$dungeon_builder$node_modules$wheel$index["default"].addWheelListener(owner,onMouseWheel);makeDirty()}function releaseEvents(){module$Applications$server$dungeon_builder$node_modules$wheel$index["default"].removeWheelListener(owner,
onMouseWheel);owner.removeEventListener("mousedown",onMouseDown);owner.removeEventListener("keydown",onKeyDown);owner.removeEventListener("dblclick",onDoubleClick);owner.removeEventListener("touchstart",onTouch);if(frameAnimation){window.cancelAnimationFrame(frameAnimation);frameAnimation=0}smoothScroll.cancel();releaseDocumentMouse();releaseTouches();triggerPanEnd()}function frame(){if(isDirty)applyTransform()}function applyTransform(){isDirty=false;panController.applyTransform(transform);triggerEvent("transform");
frameAnimation=0}function onKeyDown(e){var x=0;var y=0;var z=0;if(e.keyCode===38)y=1;else if(e.keyCode===40)y=-1;else if(e.keyCode===37)x=1;else if(e.keyCode===39)x=-1;else if(e.keyCode===189||e.keyCode===109)z=1;else if(e.keyCode===187||e.keyCode===107)z=-1;if(filterKey(e,x,y,z))return;if(x||y){e.preventDefault();e.stopPropagation();var clientRect=owner.getBoundingClientRect();var offset=Math.min(clientRect.width,clientRect.height);var moveSpeedRatio=.05;var dx=offset*moveSpeedRatio*x;var dy=offset*
moveSpeedRatio*y;internalMoveBy(dx,dy)}if(z){var scaleMultiplier=getScaleMultiplier(z);var ownerRect=owner.getBoundingClientRect();publicZoomTo(ownerRect.width/2,ownerRect.height/2,scaleMultiplier)}}function onTouch(e){beforeTouch(e);if(e.touches.length===1)return handleSingleFingerTouch(e,e.touches[0]);else if(e.touches.length===2){pinchZoomLength=getPinchZoomLength(e.touches[0],e.touches[1]);multiTouch=true;startTouchListenerIfNeeded()}}function beforeTouch(e){if(options.onTouch&&!options.onTouch(e))return;
e.stopPropagation();e.preventDefault()}function beforeDoubleClick(e){if(options.onDoubleClick&&!options.onDoubleClick(e))return;e.preventDefault();e.stopPropagation()}function handleSingleFingerTouch(e){var touch=e.touches[0];var offset=getOffsetXY(touch);mouseX=offset.x;mouseY=offset.y;smoothScroll.cancel();startTouchListenerIfNeeded()}function startTouchListenerIfNeeded(){if(!touchInProgress){touchInProgress=true;document.addEventListener("touchmove",handleTouchMove);document.addEventListener("touchend",
handleTouchEnd);document.addEventListener("touchcancel",handleTouchEnd)}}function handleTouchMove(e){if(e.touches.length===1){e.stopPropagation();var touch=e.touches[0];var offset=getOffsetXY(touch);var dx=offset.x-mouseX;var dy=offset.y-mouseY;if(dx!==0&&dy!==0)triggerPanStart();mouseX=offset.x;mouseY=offset.y;var point=transformToScreen(dx,dy);internalMoveBy(point.x,point.y)}else if(e.touches.length===2){multiTouch=true;var t1=e.touches[0];var t2=e.touches[1];var currentPinchLength=getPinchZoomLength(t1,
t2);var scaleMultiplier=1+(currentPinchLength/pinchZoomLength-1)*pinchSpeed;mouseX=(t1.clientX+t2.clientX)/2;mouseY=(t1.clientY+t2.clientY)/2;publicZoomTo(mouseX,mouseY,scaleMultiplier);pinchZoomLength=currentPinchLength;e.stopPropagation();e.preventDefault()}}function handleTouchEnd(e){if(e.touches.length>0){var offset=getOffsetXY(e.touches[0]);mouseX=offset.x;mouseY=offset.y}else{var now=new Date;if(now-lastTouchEndTime<doubleTapSpeedInMS$$module$Applications$server$dungeon_builder$node_modules$panzoom$index)smoothZoom(mouseX,
mouseY,zoomDoubleClickSpeed);lastTouchEndTime=now;touchInProgress=false;triggerPanEnd();releaseTouches()}}function getPinchZoomLength(finger1,finger2){var dx=finger1.clientX-finger2.clientX;var dy=finger1.clientY-finger2.clientY;return Math.sqrt(dx*dx+dy*dy)}function onDoubleClick(e){beforeDoubleClick(e);var offset=getOffsetXY(e);smoothZoom(offset.x,offset.y,zoomDoubleClickSpeed)}function onMouseDown(e){if(touchInProgress){e.stopPropagation();return false}var isLeftButton=e.button===1&&window.event!==
null||e.button===0;if(!isLeftButton)return;smoothScroll.cancel();var offset=getOffsetXY(e);var point=transformToScreen(offset.x,offset.y);mouseX=point.x;mouseY=point.y;document.addEventListener("mousemove",onMouseMove);document.addEventListener("mouseup",onMouseUp);if(!options.enableTextSelection)preventTextSelection$$module$Applications$server$dungeon_builder$node_modules$panzoom$index.capture(e.target||e.srcElement);return false}function onMouseMove(e){if(touchInProgress)return;triggerPanStart();
var offset=getOffsetXY(e);var point=transformToScreen(offset.x,offset.y);var dx=point.x-mouseX;var dy=point.y-mouseY;mouseX=point.x;mouseY=point.y;internalMoveBy(dx,dy)}function onMouseUp(){if(!options.enableTextSelection)preventTextSelection$$module$Applications$server$dungeon_builder$node_modules$panzoom$index.release();triggerPanEnd();releaseDocumentMouse()}function releaseDocumentMouse(){document.removeEventListener("mousemove",onMouseMove);document.removeEventListener("mouseup",onMouseUp);panstartFired=
false}function releaseTouches(){document.removeEventListener("touchmove",handleTouchMove);document.removeEventListener("touchend",handleTouchEnd);document.removeEventListener("touchcancel",handleTouchEnd);panstartFired=false;multiTouch=false}function onMouseWheel(e){if(beforeWheel(e))return;smoothScroll.cancel();var scaleMultiplier=getScaleMultiplier(e.deltaY);if(scaleMultiplier!==1){var offset=getOffsetXY(e);publicZoomTo(offset.x,offset.y,scaleMultiplier);e.preventDefault()}}function getOffsetXY(e){var offsetX;
var offsetY;var ownerRect=owner.getBoundingClientRect();offsetX=e.clientX-ownerRect.left;offsetY=e.clientY-ownerRect.top;return{x:offsetX,y:offsetY}}function smoothZoom(clientX,clientY,scaleMultiplier){var fromValue=transform.scale;var from={scale:fromValue};var to={scale:scaleMultiplier*fromValue};smoothScroll.cancel();cancelZoomAnimation();zoomToAnimation=(0,module$Applications$server$dungeon_builder$node_modules$amator$index["default"])(from,to,{step:function(v){zoomAbs(clientX,clientY,v.scale)},
done:triggerZoomEnd})}function smoothZoomAbs(clientX,clientY,toScaleValue){var fromValue=transform.scale;var from={scale:fromValue};var to={scale:toScaleValue};smoothScroll.cancel();cancelZoomAnimation();zoomToAnimation=(0,module$Applications$server$dungeon_builder$node_modules$amator$index["default"])(from,to,{step:function(v){zoomAbs(clientX,clientY,v.scale)}})}function publicZoomTo(clientX,clientY,scaleMultiplier){smoothScroll.cancel();cancelZoomAnimation();return zoomByRatio(clientX,clientY,scaleMultiplier)}
function cancelZoomAnimation(){if(zoomToAnimation){zoomToAnimation.cancel();zoomToAnimation=null}}function getScaleMultiplier(delta){var scaleMultiplier=1;if(delta>0)scaleMultiplier=1-speed;else if(delta<0)scaleMultiplier=1+speed;return scaleMultiplier}function triggerPanStart(){if(!panstartFired){triggerEvent("panstart");panstartFired=true;smoothScroll.start()}}function triggerPanEnd(){if(panstartFired){if(!multiTouch)smoothScroll.stop();triggerEvent("panend")}}function triggerZoomEnd(){triggerEvent("zoomend")}
function triggerEvent(name){api.fire(name,api)}};var wheel$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$wheel$index["default"];var animate$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$amator$index["default"];var eventify$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$ngraph_events$index["default"];
var kinetic$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$panzoom$lib$kinetic["default"];var preventTextSelection$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=(0,module$Applications$server$dungeon_builder$node_modules$panzoom$lib$textSelectionInterceptor["default"])();var Transform$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$panzoom$lib$transform["default"];
var makeSvgController$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$panzoom$lib$svgController["default"];var makeDomController$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=module$Applications$server$dungeon_builder$node_modules$panzoom$lib$domController["default"];var defaultZoomSpeed$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=.065;
var defaultDoubleTapZoomSpeed$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=1.75;var doubleTapSpeedInMS$$module$Applications$server$dungeon_builder$node_modules$panzoom$index=300;function noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(){}
function validateBounds$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds){var boundsType=typeof bounds;if(boundsType==="undefined"||boundsType==="boolean")return;var validBounds=isNumber$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds.left)&&isNumber$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds.top)&&isNumber$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds.bottom)&&isNumber$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(bounds.right);
if(!validBounds)throw new Error("Bounds object is not valid. It can be: "+"undefined, boolean (true|false) or an object {left, top, right, bottom}");}function isNumber$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(x){return Number.isFinite(x)}function isNaN$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(value){if(Number.isNaN)return Number.isNaN(value);return value!==value}
function rigidScroll$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(){return{start:noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index,stop:noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index,cancel:noop$$module$Applications$server$dungeon_builder$node_modules$panzoom$index}}
function autoRun$$module$Applications$server$dungeon_builder$node_modules$panzoom$index(){if(typeof document==="undefined")return;var scripts=document.getElementsByTagName("script");if(!scripts)return;var panzoomScript;for(var i=0;i<scripts.length;++i){var x=scripts[i];if(x.src&&x.src.match(/\bpanzoom(\.min)?\.js/)){panzoomScript=x;break}}if(!panzoomScript)return;var query=panzoomScript.getAttribute("query");if(!query)return;var globalName=panzoomScript.getAttribute("name")||"pz";var started=Date.now();
tryAttach();function tryAttach(){var el=document.querySelector(query);if(!el){var now=Date.now();var elapsed=now-started;if(elapsed<2E3){setTimeout(tryAttach,100);return}console.error("Cannot find the panzoom element",globalName);return}var options=collectOptions(panzoomScript);console.log(options);window[globalName]=(0,module$Applications$server$dungeon_builder$node_modules$panzoom$index["default"])(el,options)}function collectOptions(script){var attrs=script.attributes;var options={};for(var i=
0;i<attrs.length;++i){var attr=attrs[i];var nameValue=getPanzoomAttributeNameValue(attr);if(nameValue)options[nameValue.name]=nameValue.value}return options}function getPanzoomAttributeNameValue(attr){if(!attr.name)return;var isPanZoomAttribute=attr.name[0]==="p"&&attr.name[1]==="z"&&attr.name[2]==="-";if(!isPanZoomAttribute)return;var name=attr.name.substr(3);var value=JSON.parse(attr.value);return{name:name,value:value}}}autoRun$$module$Applications$server$dungeon_builder$node_modules$panzoom$index()